varnishtest "basic resp sanity checks"

feature cmd jq

server s1 {
	rxreq
	txresp

	rxreq
	txresp
} -start

varnish v1 -vcl+backend {
} -start

client c1 {
	txreq -url "/foo"
	rxresp

	txreq -url "/bar"
	rxresp
} -run

varnish v1 -vsl_catchup

shell {
        varnishlog-json -b -n ${v1_name} -d -q 'BereqURL eq "/foo"' | jq -er ".backend.connReused == false"
        varnishlog-json -b -n ${v1_name} -d -q 'BereqURL eq "/bar"' | jq -er ".backend.connReused == true"
}
